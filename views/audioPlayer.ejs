<audio id="audioPlayer">
    <source src="" type="audio/mpeg">
    Your browser does not support audio.
</audio>
<% if (typeof playlist !== 'undefined' && playlist) { %>
    <ul class="currentPlaylist">
        <h3><%= playlist.name %></h3>
        <li id="nextTrack">
            <p>Loading next track...</p>
        </li>
        <script>
            fetch(`/playlist/get/<%= playlist.id %>/nextTrack`)
            .then(response => response.json())
            .then(data => {
                if (data) {
                const nextTrackElement = document.getElementById('nextTrack');
                const trackTitle = document.createElement('p');
                trackTitle.textContent = data.title;
                trackTitle.onclick = function() {
                    selectSong(data.id, '<%= playlist.id %>', data.playlistIndex);
                };
                const trackArtist = document.createElement('small');
                trackArtist.textContent = data.artist;
                nextTrackElement.innerHTML = '';
                nextTrackElement.appendChild(trackTitle);
                nextTrackElement.appendChild(trackArtist);
                } else {
                document.getElementById('nextTrack').innerHTML = '<p>No next track available</p>';
                }
            })
            .catch(error => {
                console.error('Error fetching next track:', error);
                document.getElementById('nextTrack').innerHTML = '<p>Error loading next track</p>';
            });
        </script>
    </ul>
<% } %>
<div class="w-100 column-container">
    <div class="audioPlayerData">
        <div class="title-progress-container">
            <h1 class="title-progress" id="title-progress">
                <span id="title-text">Loading Track Title</span>
                <input type="range" id="title-progress-slider" class="title-progress-slider">
            </h1>
        </div>
        <p>Made by <strong id="title-artist">Loading Artist</strong></p>
    </div>
    <div class="audioPlayerControls">
        <button id="playButton" onclick="togglePlayPause()"><img id="playPauseIcon" src="/images/icons/play.svg"
                style="filter: invert(1);" value="0" max="100" step="0.01"></button>
        <script>
            function togglePlayPause() {
                var audioPlayer = document.getElementById('audioPlayer');
                var playPauseIcon = document.getElementById('playPauseIcon');
                if (audioPlayer.paused) {
                    playPauseIcon.src = '/images/icons/pause.svg';
                } else {
                    playPauseIcon.src = '/images/icons/play.svg';
                }
            }
        </script>
        <button id="nextButton"><img src="/images/icons/skip-forward.svg" style="filter: invert(1);"></button>
        <button id="pastButton"><img src="/images/icons/skip-backward.svg" style="filter: invert(1);"></button>
        <button id="stopButton"><img src="/images/icons/stop.svg" style="filter: invert(1);"
                src='/images/icons/play.svg' ;"></button>
        <button id="repeatButton">
            <img src="/images/icons/repeat.svg" style="filter: invert(1);"></button>
    </div>
</div>
<canvas id="audioVisualizer" class="audioPlayerVisualizer" height="100%"></canvas>
<script src="/js/player.js"></script>